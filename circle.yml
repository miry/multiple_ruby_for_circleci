machine:
  java:
    version: openjdk7
  environment:
    RAILS_ENV: test
    JRUBY_OPTS: -J-XX:+TieredCompilation -J-XX:TieredStopAtLevel=1 -J-noverify -X-C -Xcompile.invokedynamic=false --1.9 -J-Xmx2g

dependencies:
  cache_directories:
    - '~/.rvm/rubies'
    - 'vendor'

  pre:
    - env

  override:
    - >
      case $CIRCLE_NODE_INDEX in
       0)
         rvm --ruby-version use 2.2.3
         ;;
       1)
         rvm --ruby-version use 2.3.0
         ;;
       2)
         rvm --ruby-version use jruby
         ;;
      esac

    - bundle install

test:
  override:
    - ruby --version
